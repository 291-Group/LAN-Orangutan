<!DOCTYPE html>
<html lang="en" data-theme="{{.Theme}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAN Orangutan - Network Discovery</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü¶ß</text></svg>">
</head>
<body>
    <header class="header">
        <div class="header-brand">
            <span class="logo">ü¶ß</span>
            <h1>LAN Orangutan</h1>
        </div>
        <nav class="header-nav">
            <a href="/" class="nav-link active">Dashboard</a>
            <a href="/settings" class="nav-link">Settings</a>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">‚óê</button>
        </nav>
    </header>

    <main class="main">
        <section class="section">
            <h2 class="section-title">Network Status</h2>
            <div class="network-cards">
                {{range .Networks}}
                <div class="card network-card {{if .IsTailscale}}tailscale{{end}}">
                    <div class="card-header">
                        <span class="network-name">{{.FriendlyName}}</span>
                        <span class="status-badge online">‚óè</span>
                    </div>
                    <div class="card-body">
                        <div class="network-detail">
                            <span class="label">CIDR</span>
                            <span class="value">{{.CIDR}}</span>
                        </div>
                        <div class="network-detail">
                            <span class="label">Interface</span>
                            <span class="value">{{.Interface}}</span>
                        </div>
                        <div class="network-detail">
                            <span class="label">IP</span>
                            <span class="value">{{.IP}}</span>
                        </div>
                    </div>
                    <div class="card-footer">
                        <button class="btn btn-primary btn-sm" onclick="scanNetwork('{{.CIDR}}')">Scan Now</button>
                    </div>
                </div>
                {{end}}

                {{if and .Tailscale.Installed .Tailscale.Running}}
                <div class="card network-card tailscale">
                    <div class="card-header">
                        <span class="network-name">Tailscale</span>
                        <span class="status-badge online">‚óè</span>
                    </div>
                    <div class="card-body">
                        <div class="network-detail">
                            <span class="label">Status</span>
                            <span class="value">‚úì Connected</span>
                        </div>
                        {{if .Tailscale.SelfIP}}
                        <div class="network-detail">
                            <span class="label">IP</span>
                            <span class="value">{{.Tailscale.SelfIP}}</span>
                        </div>
                        {{end}}
                        <div class="network-detail">
                            <span class="label">Peers</span>
                            <span class="value">{{.Tailscale.PeerCount}}</span>
                        </div>
                    </div>
                </div>
                {{end}}
            </div>
        </section>

        <section class="section">
            <div class="stats-bar">
                <div class="stat">
                    <span class="stat-value">{{.Stats.Total}}</span>
                    <span class="stat-label">Total Devices</span>
                </div>
                <div class="stat">
                    <span class="stat-value online">{{.Stats.Online}}</span>
                    <span class="stat-label">Online Now</span>
                </div>
                <div class="stat">
                    <span class="stat-value">{{.Stats.Offline}}</span>
                    <span class="stat-label">Offline</span>
                </div>
                <div class="stat">
                    <span class="stat-value">{{len .Networks}}</span>
                    <span class="stat-label">Networks</span>
                </div>
            </div>
        </section>

        <section class="section">
            <div class="section-header">
                <h2 class="section-title">Discovered Devices</h2>
                <div class="section-actions">
                    <input type="text" id="device-search" class="input" placeholder="Search..." oninput="filterDevices()">
                    <select id="device-filter" class="select" onchange="filterDevices()">
                        <option value="all">All</option>
                        <option value="online">Online</option>
                        <option value="offline">Offline</option>
                    </select>
                    <button class="btn btn-primary" onclick="scanAllNetworks()">Scan All</button>
                </div>
            </div>

            <div class="table-container">
                <table class="table" id="devices-table">
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>IP Address</th>
                            <th>Hostname</th>
                            <th>MAC Address</th>
                            <th>Vendor</th>
                            <th>Label</th>
                            <th>Group</th>
                            <th>Last Seen</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="devices-tbody">
                        {{range .Devices}}
                        <tr class="device-row {{.StatusClass}}"
                            data-ip="{{.IP}}"
                            data-hostname="{{lower .Hostname}}"
                            data-mac="{{lower .MAC}}"
                            data-vendor="{{lower .Vendor}}"
                            data-label="{{lower .Label}}"
                            data-label-original="{{.Label}}"
                            data-status="{{.Status}}">
                            <td><span class="status-indicator {{.StatusClass}}">‚óè</span></td>
                            <td class="ip-cell">{{.IP}}</td>
                            <td>{{if .Hostname}}{{.Hostname}}{{else}}-{{end}}</td>
                            <td class="mac-cell">{{if .MAC}}{{.MAC}}{{else}}-{{end}}</td>
                            <td>{{if .Vendor}}{{.Vendor}}{{else}}Unknown{{end}}</td>
                            <td>{{.Label}}</td>
                            <td>
                                <select class="group-select" data-ip="{{.IP}}" onchange="updateDeviceGroup(this)">
                                    <option value="">-</option>
                                    <option value="Server" {{if eq .Group "Server"}}selected{{end}}>Server</option>
                                    <option value="Desktop" {{if eq .Group "Desktop"}}selected{{end}}>Desktop</option>
                                    <option value="Laptop" {{if eq .Group "Laptop"}}selected{{end}}>Laptop</option>
                                    <option value="Mobile" {{if eq .Group "Mobile"}}selected{{end}}>Mobile</option>
                                    <option value="IoT" {{if eq .Group "IoT"}}selected{{end}}>IoT</option>
                                    <option value="Network" {{if eq .Group "Network"}}selected{{end}}>Network</option>
                                    <option value="Pi" {{if eq .Group "Pi"}}selected{{end}}>Pi</option>
                                </select>
                            </td>
                            <td class="time-cell">{{.TimeAgo}}</td>
                            <td class="actions-cell">
                                <button class="btn-icon" onclick="editDevice('{{.IP}}')" title="Edit">‚úé</button>
                                <button class="btn-icon danger" onclick="deleteDevice('{{.IP}}')" title="Delete">‚úï</button>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{if not .Devices}}
            <div class="empty-state">
                <p>No devices discovered yet. Click "Scan All" to discover devices.</p>
            </div>
            {{end}}
        </section>
    </main>

    <div id="edit-modal" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Device</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="edit-form">
                    <input type="hidden" id="edit-ip" name="ip">
                    <div class="form-group">
                        <label>IP Address</label>
                        <input type="text" id="edit-ip-display" class="input" disabled>
                    </div>
                    <div class="form-group">
                        <label>Label</label>
                        <input type="text" id="edit-label" name="label" class="input" placeholder="e.g., Living Room TV">
                    </div>
                    <div class="form-group">
                        <label>Group</label>
                        <select id="edit-group" name="group" class="select">
                            <option value="">None</option>
                            <option value="Server">Server</option>
                            <option value="Desktop">Desktop</option>
                            <option value="Laptop">Laptop</option>
                            <option value="Mobile">Mobile</option>
                            <option value="IoT">IoT</option>
                            <option value="Network">Network</option>
                            <option value="Pi">Pi</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="edit-notes" name="notes" class="input" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveDevice()">Save</button>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>
    <div id="scan-progress" class="scan-progress" style="display:none">
        <div class="scan-spinner"></div>
        <span>Scanning...</span>
    </div>

    <footer class="footer">
        <p>ü¶ß LAN Orangutan by <a href="https://291group.com" target="_blank">291 Group</a></p>
    </footer>

    <script src="/static/app.js"></script>
</body>
</html>
